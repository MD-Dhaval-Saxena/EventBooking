<!DOCTYPE html>
<html>
  <head>
    <title>Magic Ethereum ðŸ’Ž</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="styles.css" />
    <script src="https://auth.magic.link/sdk"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.2.11/dist/web3.min.js"></script>
    <script>
      /* Configure Ethereum provider */
      const magic = new Magic("pk_live_2E88EF4ADCFFF3E3", {
        network: "sepolia"
      });
      const web3 = new Web3(magic.rpcProvider);

      /*  Smart contract values */
      const contractABI =
      `[
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_token",
				"type": "address"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "eventId",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "EventName",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "Owner",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "Date",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "starTime",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "endTime",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "tickets",
				"type": "uint256"
			}
		],
		"name": "EventCreate",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "CancelEvent",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_eventID",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_category",
				"type": "uint256"
			}
		],
		"name": "Cancel_event",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "acc",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			}
		],
		"name": "ViewTicket",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "WithdrawETH",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_eventID",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "category",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "price",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "totalTickets",
				"type": "uint256"
			}
		],
		"name": "add_Ticket_Category",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_eventID",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_category",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_quantity",
				"type": "uint256"
			}
		],
		"name": "bookTicket",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "eventID",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "category",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "quantity",
				"type": "uint256"
			}
		],
		"name": "cancelTicket",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_eventID",
				"type": "uint256"
			}
		],
		"name": "claimRefund",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_eventID",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_EventName",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_Date",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_startTime",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_endTime",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_tickets",
				"type": "uint256"
			}
		],
		"name": "createEvent",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "eventIdTracker",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "eventInfo",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "eventId",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "EventName",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "Owner",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "Date",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "startTime",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "endTime",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "tickets",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "eventTicketCategories",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "price",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "totalTickets",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "remainingTickets",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			},
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			},
			{
				"internalType": "bytes",
				"name": "",
				"type": "bytes"
			}
		],
		"name": "onERC1155BatchReceived",
		"outputs": [
			{
				"internalType": "bytes4",
				"name": "",
				"type": "bytes4"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "bytes",
				"name": "",
				"type": "bytes"
			}
		],
		"name": "onERC1155Received",
		"outputs": [
			{
				"internalType": "bytes4",
				"name": "",
				"type": "bytes4"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes4",
				"name": "interfaceId",
				"type": "bytes4"
			}
		],
		"name": "supportsInterface",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "userFunds",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "viewAllEvents",
		"outputs": [
			{
				"components": [
					{
						"internalType": "uint256",
						"name": "eventId",
						"type": "uint256"
					},
					{
						"internalType": "string",
						"name": "EventName",
						"type": "string"
					},
					{
						"internalType": "address",
						"name": "Owner",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "Date",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "startTime",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "endTime",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "tickets",
						"type": "uint256"
					},
					{
						"internalType": "uint256[]",
						"name": "ticketCategories",
						"type": "uint256[]"
					}
				],
				"internalType": "struct EventBooking.Event[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]`;
    const byteCode=0x608060405260006001553480156200001657600080fd5b5060405162002fb338038062002fb383398181016040528101906200003c91906200009a565b806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550506200011f565b600081519050620000948162000105565b92915050565b600060208284031215620000b357620000b262000100565b5b6000620000c38482850162000083565b91505092915050565b6000620000d982620000e0565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600080fd5b6200011081620000cc565b81146200011c57600080fd5b50565b612e84806200012f6000396000f3fe6080604052600436106100fe5760003560e01c8063b96a7c6b11610095578063f23a6e6111610064578063f23a6e611461032b578063f53db87414610368578063f5692cde14610391578063f616ecf8146103ce578063fdd69d84146103f7576100fe565b8063b96a7c6b14610249578063bc197c8114610286578063e933406c146102c3578063ea1f1fdd14610300576100fe565b80639d0c025b116100d15780639d0c025b1461018f578063a1e1fc43146101d2578063a5004616146101ee578063b019d3e51461022d576100fe565b806301ffc9a7146101035780630f1df574146101405780634f46db681461014a5780635b7baf6414610173575b600080fd5b34801561010f57600080fd5b5061012a60048036038101906101259190611d63565b610422565b6040516101379190612475565b60405180910390f35b61014861049c565b005b34801561015657600080fd5b50610171600480360381019061016c9190611ed3565b6104e5565b005b61018d60048036038101906101889190611d90565b610783565b005b34801561019b57600080fd5b506101b660048036038101906101b19190611d90565b61096a565b6040516101c99796959493929190612646565b60405180910390f35b6101ec60048036038101906101e79190611f13565b610a54565b005b3480156101fa57600080fd5b5061021560048036038101906102109190611ed3565b610b90565b604051610224939291906126bc565b60405180910390f35b61024760048036038101906102429190611f13565b610bc7565b005b34801561025557600080fd5b50610270600480360381019061026b9190611dea565b610f7a565b60405161027d919061262b565b60405180910390f35b34801561029257600080fd5b506102ad60048036038101906102a89190611bbd565b610f9f565b6040516102ba9190612490565b60405180910390f35b3480156102cf57600080fd5b506102ea60048036038101906102e59190611d90565b610fb4565b6040516102f79190612475565b60405180910390f35b34801561030c57600080fd5b50610315610fd4565b6040516103229190612453565b60405180910390f35b34801561033757600080fd5b50610352600480360381019061034d9190611c8c565b611213565b60405161035f9190612490565b60405180910390f35b34801561037457600080fd5b5061038f600480360381019061038a9190611e2a565b611228565b005b34801561039d57600080fd5b506103b860048036038101906103b39190611d23565b6114b9565b6040516103c5919061262b565b60405180910390f35b3480156103da57600080fd5b506103f560048036038101906103f09190611f66565b61156e565b005b34801561040357600080fd5b5061040c6117cf565b604051610419919061262b565b60405180910390f35b60007f4e2312e0000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614806104955750610494826117d5565b5b9050919050565b3373ffffffffffffffffffffffffffffffffffffffff166108fc479081150290604051600060405180830381858888f193505050501580156104e2573d6000803e3d6000fd5b50565b60006003600084815260200190815260200160002090503373ffffffffffffffffffffffffffffffffffffffff168160020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161461058e576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105859061250b565b60405180910390fd5b60016006600085815260200190815260200160002060006101000a81548160ff021916908315150217905550600360008481526020019081526020016000206000808201600090556001820160006105e6919061183f565b6002820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff0219169055600382016000905560048201600090556005820160009055600682016000905560078201600061063d919061187f565b505060008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1662fdd58e33856040518363ffffffff1660e01b815260040161069c9291906123f3565b60206040518083038186803b1580156106b457600080fd5b505afa1580156106c8573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906106ec9190611dbd565b905060008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663f5298aca3385846040518463ffffffff1660e01b815260040161074b9392919061241c565b600060405180830381600087803b15801561076557600080fd5b505af1158015610779573d6000803e3d6000fd5b5050505050505050565b6006600082815260200190815260200160002060009054906101000a900460ff166107e3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107da9061256b565b60405180910390fd5b60006007600083815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205411610876576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161086d906125cb565b60405180910390fd5b60006007600083815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490503373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050158015610911573d6000803e3d6000fd5b506007600083815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600090555050565b600360205280600052604060002060009150905080600001549080600101805461099390612a10565b80601f01602080910402602001604051908101604052809291908181526020018280546109bf90612a10565b8015610a0c5780601f106109e157610100808354040283529160200191610a0c565b820191906000526020600020905b8154815290600101906020018083116109ef57829003601f168201915b5050505050908060020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060030154908060040154908060050154908060060154905087565b600060046000858152602001908152602001600020600084815260200190815260200160002090506000828260000154610a8e91906128cc565b90506000600a82610a9f919061289b565b905060008183610aaf9190612926565b90503373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050158015610af7573d6000803e3d6000fd5b5060008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663f5298aca3388886040518463ffffffff1660e01b8152600401610b559392919061241c565b600060405180830381600087803b158015610b6f57600080fd5b505af1158015610b83573d6000803e3d6000fd5b5050505050505050505050565b6004602052816000526040600020602052806000526040600020600091509150508060000154908060010154908060020154905083565b6000600360008581526020019081526020016000209050600073ffffffffffffffffffffffffffffffffffffffff168160020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161415610c72576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c699061254b565b60405180910390fd5b6000600460008681526020019081526020016000206000858152602001908152602001600020905060003411610cdd576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610cd4906124ab565b60405180910390fd5b60008311610d20576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d17906124eb565b60405180910390fd5b8060010154831115610d67576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d5e9061258b565b60405180910390fd5b6000816000015411610dae576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610da59061260b565b60405180910390fd5b6000816001015411610df5576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610dec906125eb565b60405180910390fd5b828160000154610e0591906128cc565b341015610e47576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610e3e9061252b565b60405180910390fd5b82826006016000828254610e5b9190612926565b9250508190555082816001016000828254610e769190612926565b9250508190555060008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663156e29f63386866040518463ffffffff1660e01b8152600401610eda9392919061241c565b600060405180830381600087803b158015610ef457600080fd5b505af1158015610f08573d6000803e3d6000fd5b50505050346007600087815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254610f6c9190612845565b925050819055505050505050565b6007602052816000526040600020602052806000526040600020600091509150505481565b600063bc197c8160e01b905095945050505050565b60066020528060005260406000206000915054906101000a900460ff1681565b6060600060028054905067ffffffffffffffff811115610ff757610ff6612b78565b5b60405190808252806020026020018201604052801561103057816020015b61101d6118a0565b8152602001906001900390816110155790505b50905060005b60028054905081101561120b57600060036000838152602001908152602001600020905080604051806101000160405290816000820154815260200160018201805461108190612a10565b80601f01602080910402602001604051908101604052809291908181526020018280546110ad90612a10565b80156110fa5780601f106110cf576101008083540402835291602001916110fa565b820191906000526020600020905b8154815290600101906020018083116110dd57829003601f168201915b505050505081526020016002820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200160038201548152602001600482015481526020016005820154815260200160068201548152602001600782018054806020026020016040519081016040528092919081815260200182805480156111d057602002820191906000526020600020905b8154815260200190600101908083116111bc575b5050505050815250508383815181106111ec576111eb612b49565b5b602002602001018190525050808061120390612a73565b915050611036565b508091505090565b600063f23a6e6160e01b905095945050505050565b6001600081548092919061123b90612a73565b91905055506000600360008881526020019081526020016000209050806000015487141561129e576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611295906125ab565b60405180910390fd5b6040518061010001604052808881526020018781526020013373ffffffffffffffffffffffffffffffffffffffff168152602001868152602001858152602001848152602001838152602001600067ffffffffffffffff81111561130557611304612b78565b5b6040519080825280602002602001820160405280156113335781602001602082028036833780820191505090505b50815250600360008981526020019081526020016000206000820151816000015560208201518160010190805190602001906113709291906118fb565b5060408201518160020160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550606082015181600301556080820151816004015560a0820151816005015560c0820151816006015560e08201518160070190805190602001906113fc929190611981565b509050507f5c30e3fd1193c6f786c2a191f86645ebf2b9da7c0330b79735513ad8c577d96e8787338888888860405161143b9796959493929190612646565b60405180910390a181600560008981526020019081526020016000208190555060006006600089815260200190815260200160002060006101000a81548160ff021916908315150217905550600287908060018154018082558091505060019003906000526020600020016000909190919091505550505050505050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1662fdd58e84846040518363ffffffff1660e01b81526004016115169291906123f3565b60206040518083038186803b15801561152e57600080fd5b505afa158015611542573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906115669190611dbd565b905092915050565b60006003600086815260200190815260200160002090503373ffffffffffffffffffffffffffffffffffffffff168160020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614611617576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161160e9061250b565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168160020160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614156116ab576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016116a29061254b565b60405180910390fd5b6005600086815260200190815260200160002054821115611701576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016116f8906124cb565b60405180910390fd5b60036000868152602001908152602001600020600701849080600181540180825580915050600190039060005260206000200160009091909190915055604051806060016040528084815260200183815260200183815250600460008781526020019081526020016000206000868152602001908152602001600020600082015181600001556020820151816001015560408201518160020155905050816005600087815260200190815260200160002060008282546117c19190612926565b925050819055505050505050565b60015481565b60007f01ffc9a7000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916149050919050565b50805461184b90612a10565b6000825580601f1061185d575061187c565b601f01602090049060005260206000209081019061187b91906119ce565b5b50565b508054600082559060005260206000209081019061189d91906119ce565b50565b6040518061010001604052806000815260200160608152602001600073ffffffffffffffffffffffffffffffffffffffff16815260200160008152602001600081526020016000815260200160008152602001606081525090565b82805461190790612a10565b90600052602060002090601f0160209004810192826119295760008555611970565b82601f1061194257805160ff1916838001178555611970565b82800160010185558215611970579182015b8281111561196f578251825591602001919060010190611954565b5b50905061197d91906119ce565b5090565b8280548282559060005260206000209081019282156119bd579160200282015b828111156119bc5782518255916020019190600101906119a1565b5b5090506119ca91906119ce565b5090565b5b808211156119e75760008160009055506001016119cf565b5090565b60006119fe6119f984612718565b6126f3565b90508083825260208201905082856020860282011115611a2157611a20612bac565b5b60005b85811015611a515781611a378882611b93565b845260208401935060208301925050600181019050611a24565b5050509392505050565b6000611a6e611a6984612744565b6126f3565b905082815260208101848484011115611a8a57611a89612bb1565b5b611a958482856129ce565b509392505050565b6000611ab0611aab84612775565b6126f3565b905082815260208101848484011115611acc57611acb612bb1565b5b611ad78482856129ce565b509392505050565b600081359050611aee81612e09565b92915050565b600082601f830112611b0957611b08612ba7565b5b8135611b198482602086016119eb565b91505092915050565b600081359050611b3181612e20565b92915050565b600082601f830112611b4c57611b4b612ba7565b5b8135611b5c848260208601611a5b565b91505092915050565b600082601f830112611b7a57611b79612ba7565b5b8135611b8a848260208601611a9d565b91505092915050565b600081359050611ba281612e37565b92915050565b600081519050611bb781612e37565b92915050565b600080600080600060a08688031215611bd957611bd8612bbb565b5b6000611be788828901611adf565b9550506020611bf888828901611adf565b945050604086013567ffffffffffffffff811115611c1957611c18612bb6565b5b611c2588828901611af4565b935050606086013567ffffffffffffffff811115611c4657611c45612bb6565b5b611c5288828901611af4565b925050608086013567ffffffffffffffff811115611c7357611c72612bb6565b5b611c7f88828901611b37565b9150509295509295909350565b600080600080600060a08688031215611ca857611ca7612bbb565b5b6000611cb688828901611adf565b9550506020611cc788828901611adf565b9450506040611cd888828901611b93565b9350506060611ce988828901611b93565b925050608086013567ffffffffffffffff811115611d0a57611d09612bb6565b5b611d1688828901611b37565b9150509295509295909350565b60008060408385031215611d3a57611d39612bbb565b5b6000611d4885828601611adf565b9250506020611d5985828601611b93565b9150509250929050565b600060208284031215611d7957611d78612bbb565b5b6000611d8784828501611b22565b91505092915050565b600060208284031215611da657611da5612bbb565b5b6000611db484828501611b93565b91505092915050565b600060208284031215611dd357611dd2612bbb565b5b6000611de184828501611ba8565b91505092915050565b60008060408385031215611e0157611e00612bbb565b5b6000611e0f85828601611b93565b9250506020611e2085828601611adf565b9150509250929050565b60008060008060008060c08789031215611e4757611e46612bbb565b5b6000611e5589828a01611b93565b965050602087013567ffffffffffffffff811115611e7657611e75612bb6565b5b611e8289828a01611b65565b9550506040611e9389828a01611b93565b9450506060611ea489828a01611b93565b9350506080611eb589828a01611b93565b92505060a0611ec689828a01611b93565b9150509295509295509295565b60008060408385031215611eea57611ee9612bbb565b5b6000611ef885828601611b93565b9250506020611f0985828601611b93565b9150509250929050565b600080600060608486031215611f2c57611f2b612bbb565b5b6000611f3a86828701611b93565b9350506020611f4b86828701611b93565b9250506040611f5c86828701611b93565b9150509250925092565b60008060008060808587031215611f8057611f7f612bbb565b5b6000611f8e87828801611b93565b9450506020611f9f87828801611b93565b9350506040611fb087828801611b93565b9250506060611fc187828801611b93565b91505092959194509250565b6000611fd9838361231e565b905092915050565b6000611fed83836123d5565b60208301905092915050565b6120028161295a565b82525050565b6120118161295a565b82525050565b6000612022826127c6565b61202c8185612801565b93508360208202850161203e856127a6565b8060005b8581101561207a578484038952815161205b8582611fcd565b9450612066836127e7565b925060208a01995050600181019050612042565b50829750879550505050505092915050565b6000612097826127d1565b6120a18185612812565b93506120ac836127b6565b8060005b838110156120dd5781516120c48882611fe1565b97506120cf836127f4565b9250506001810190506120b0565b5085935050505092915050565b6120f38161296c565b82525050565b61210281612978565b82525050565b6000612113826127dc565b61211d8185612823565b935061212d8185602086016129dd565b61213681612bc0565b840191505092915050565b600061214c826127dc565b6121568185612834565b93506121668185602086016129dd565b61216f81612bc0565b840191505092915050565b6000612187601283612834565b915061219282612bd1565b602082019050919050565b60006121aa601883612834565b91506121b582612bfa565b602082019050919050565b60006121cd601583612834565b91506121d882612c23565b602082019050919050565b60006121f0601483612834565b91506121fb82612c4c565b602082019050919050565b6000612213601083612834565b915061221e82612c75565b602082019050919050565b6000612236600f83612834565b915061224182612c9e565b602082019050919050565b6000612259601683612834565b915061226482612cc7565b602082019050919050565b600061227c602783612834565b915061228782612cf0565b604082019050919050565b600061229f601683612834565b91506122aa82612d3f565b602082019050919050565b60006122c2602c83612834565b91506122cd82612d68565b604082019050919050565b60006122e5601083612834565b91506122f082612db7565b602082019050919050565b6000612308601883612834565b915061231382612de0565b602082019050919050565b60006101008301600083015161233760008601826123d5565b506020830151848203602086015261234f8282612108565b91505060408301516123646040860182611ff9565b50606083015161237760608601826123d5565b50608083015161238a60808601826123d5565b5060a083015161239d60a08601826123d5565b5060c08301516123b060c08601826123d5565b5060e083015184820360e08601526123c8828261208c565b9150508091505092915050565b6123de816129c4565b82525050565b6123ed816129c4565b82525050565b60006040820190506124086000830185612008565b61241560208301846123e4565b9392505050565b60006060820190506124316000830186612008565b61243e60208301856123e4565b61244b60408301846123e4565b949350505050565b6000602082019050818103600083015261246d8184612017565b905092915050565b600060208201905061248a60008301846120ea565b92915050565b60006020820190506124a560008301846120f9565b92915050565b600060208201905081810360008301526124c48161217a565b9050919050565b600060208201905081810360008301526124e48161219d565b9050919050565b60006020820190508181036000830152612504816121c0565b9050919050565b60006020820190508181036000830152612524816121e3565b9050919050565b6000602082019050818103600083015261254481612206565b9050919050565b6000602082019050818103600083015261256481612229565b9050919050565b600060208201905081810360008301526125848161224c565b9050919050565b600060208201905081810360008301526125a48161226f565b9050919050565b600060208201905081810360008301526125c481612292565b9050919050565b600060208201905081810360008301526125e4816122b5565b9050919050565b60006020820190508181036000830152612604816122d8565b9050919050565b60006020820190508181036000830152612624816122fb565b9050919050565b600060208201905061264060008301846123e4565b92915050565b600060e08201905061265b600083018a6123e4565b818103602083015261266d8189612141565b905061267c6040830188612008565b61268960608301876123e4565b61269660808301866123e4565b6126a360a08301856123e4565b6126b060c08301846123e4565b98975050505050505050565b60006060820190506126d160008301866123e4565b6126de60208301856123e4565b6126eb60408301846123e4565b949350505050565b60006126fd61270e565b90506127098282612a42565b919050565b6000604051905090565b600067ffffffffffffffff82111561273357612732612b78565b5b602082029050602081019050919050565b600067ffffffffffffffff82111561275f5761275e612b78565b5b61276882612bc0565b9050602081019050919050565b600067ffffffffffffffff8211156127905761278f612b78565b5b61279982612bc0565b9050602081019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b600081519050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b6000602082019050919050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b6000612850826129c4565b915061285b836129c4565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff038211156128905761288f612abc565b5b828201905092915050565b60006128a6826129c4565b91506128b1836129c4565b9250826128c1576128c0612aeb565b5b828204905092915050565b60006128d7826129c4565b91506128e2836129c4565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff048311821515161561291b5761291a612abc565b5b828202905092915050565b6000612931826129c4565b915061293c836129c4565b92508282101561294f5761294e612abc565b5b828203905092915050565b6000612965826129a4565b9050919050565b60008115159050919050565b60007fffffffff0000000000000000000000000000000000000000000000000000000082169050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b82818337600083830152505050565b60005b838110156129fb5780820151818401526020810190506129e0565b83811115612a0a576000848401525b50505050565b60006002820490506001821680612a2857607f821691505b60208210811415612a3c57612a3b612b1a565b5b50919050565b612a4b82612bc0565b810181811067ffffffffffffffff82111715612a6a57612a69612b78565b5b80604052505050565b6000612a7e826129c4565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff821415612ab157612ab0612abc565b5b600182019050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f46756e6473204e6f742070726f76696465640000000000000000000000000000600082015250565b7f4e6f7420456e6f756768205469636b657420746f206164640000000000000000600082015250565b7f7175616e74697479204e6f742070726f76696465640000000000000000000000600082015250565b7f4f6e6c79204576656e74204f7267616e697a6572000000000000000000000000600082015250565b7f4e6f7420456e6f7567682046756e647300000000000000000000000000000000600082015250565b7f4576656e74204e6f7420466f756e640000000000000000000000000000000000600082015250565b7f4576656e74206973204e6f742063616e63656c6c656400000000000000000000600082015250565b7f5175616e74697479206973206d6f7265207468616e20617661696c61626c652060008201527f5469636b65747300000000000000000000000000000000000000000000000000602082015250565b7f4576656e74496420416c65726561647920457869737400000000000000000000600082015250565b7f596f7572206e6f7420656c696769626c65206f7220616c72656164792077697460008201527f68647261776e2066756e64730000000000000000000000000000000000000000602082015250565b7f5469636b65747320536f6c64204f757400000000000000000000000000000000600082015250565b7f496e76616c6964207469636b65742063617465676f7279200000000000000000600082015250565b612e128161295a565b8114612e1d57600080fd5b50565b612e2981612978565b8114612e3457600080fd5b50565b612e40816129c4565b8114612e4b57600080fd5b5056fea2646970667358221220c9ac3d88e6e1c4fa251788256ce32fb485bdba418e7a2b8f4cba7b84b414441e64736f6c63430008070033;
      const contractByteCode = byteCode.toString();
      let contractAddress = "0xbE49E4E521bA279840D45AF6C8022524C21feb29";

      const render = async () => {
        const isLoggedIn = await magic.user.isLoggedIn();
        /* Show login form if user is not logged in */
        let authHtml = `
          <div class="container">
            <h1>Please sign up or login</h1>
            <form onsubmit="handleLogin(event)">
              <input type="email" name="email" required="required" placeholder="Enter your email" />
              <button type="submit">Send</button>
            </form>
          </div>
        `;
        let userHtml = "";
        let txnHtml = "";
        let signHtml = "";
        let contractHtml = "";
        const target = document.querySelector("#app");
        if (isLoggedIn) {
          /* Get user metadata including email */
          const userMetadata = await magic.user.getMetadata();
          const network = await web3.eth.net.getNetworkType();
          const userAddress = (await web3.eth.getAccounts())[0];
          const userBalance = web3.utils.fromWei(
            await web3.eth.getBalance(userAddress) // Balance is in wei
          );
          authHtml = `
            <div class="container">
              <h1>Current user: ${userMetadata.email}</h1>
              <button onclick="handleLogout()">Logout</button>
            </div>
          `;
          userHtml = `
            <div class="container">
              <h1>Ethereum address</h1>
              <div class="info">
                <a href="https://goerli.etherscan.io/address/${userAddress}" target="_blank">${userAddress}</a>
              </div>
              <h1>Network</h1>
              <div class="info">${network}</div>
              <h1>Balance</h1>
              <div class="info">${userBalance} ETH</div>
            </div>
          `;
          txnHtml = `
            <div class="container">
              <h1>Send Transaction</h1>
              <form onsubmit="handleSendTxn(event)">
                <input type="text" name="destination" class="full-width" required="required" placeholder="Destination address" />
                <input type="text" name="amount" class="full-width" required="required" placeholder="Amount in ETH" />
                <button id="btn-send-txn" type="submit">Send Transaction</button>
              </form>
            </div>
          `;
          signHtml = `
            <div class="container">
              <h1>Sign Message</h1>
              <form onsubmit="handleSignMsg(event)">
                <input type="text" name="message" class="full-width" placeholder="Message" />
                <button id="btn-sign-msg" type="submit">Sign Message</button>
              </form>
            </div>
          `;
          let contract = new web3.eth.Contract(
            JSON.parse(contractABI),
            contractAddress
          );
          const currentMessage = await contract.methods.message().call();
          contractHtml = `
            <div class="container">
              <h1>Smart Contract</h1>
              <div class="info">
                <a href="https://sepolia.etherscan.io/address/${contractAddress}" target="_blank">${contractAddress}</a>
              </div>
              <h1>Message</h1>
              <div class="info">${currentMessage}</div>
              <form onsubmit="handleUpdateMsg(event)">
                <input type="text" name="new-message" class="full-width" required="required" placeholder="New Message" />
                <button id="btn-deploy" onclick="handleDeploy()">New Contract</button>
                <button id="btn-update-msg" type="submit">Update Message</button>
              </form>
            </div>
          `;
        }
        target.innerHTML =
          authHtml + userHtml + txnHtml + signHtml + contractHtml;
      };

      const handleLogin = async e => {
        e.preventDefault();
        const email = new FormData(e.target).get("email");
        if (email) {
          /* One-liner login ðŸ¤¯ */
          await magic.auth.loginWithMagicLink({ email });
          render();
        }
      };

      const handleSendTxn = async e => {
        e.preventDefault();
        const destination = new FormData(e.target).get("destination");
        const amount = new FormData(e.target).get("amount");
        if (destination && amount) {
          const btnSendTxn = document.getElementById("btn-send-txn");
          btnSendTxn.disabled = true;
          btnSendTxn.innerText = "Sending...";
          const fromAddress = (await web3.eth.getAccounts())[0];
          // Submit transaction to the blockchain and wait for it to be mined
          const receipt = await web3.eth.sendTransaction({
            from: fromAddress,
            to: destination,
            value: web3.utils.toWei(amount)
          });
          console.log("Completed:", receipt);
          render();
        }
      };

      const handleSignMsg = async e => {
        e.preventDefault();
        const message = new FormData(e.target).get("message");
        if (message) {
          const userAddress = (await web3.eth.getAccounts())[0];
          const signedMessage = await web3.eth.personal.sign(
            message,
            userAddress
          );
          alert(`Signed Message: ${signedMessage}`);
          console.log(signedMessage);
          /*const signerAddress = await web3.eth.personal.ecRecover(
            message,
            signedMessage
          );
          console.log(userAddress);
          console.log(signerAddress);
          console.log(signerAddress == userAddress);*/
        }
      };

      const handleUpdateMsg = async e => {
        e.preventDefault();
        const newMessage = new FormData(e.target).get("new-message");
        if (newMessage) {
          const btnUpdateMsg = document.getElementById("btn-update-msg");
          btnUpdateMsg.disabled = true;
          btnUpdateMsg.innerText = "Updating...";
          const fromAddress = (await web3.eth.getAccounts())[0];
          const contract = new web3.eth.Contract(
            JSON.parse(contractABI),
            contractAddress
          );
          const receipt = await contract.methods
            .update(newMessage)
            .send({ from: fromAddress });
          console.log("Completed:", receipt);
          render();
        }
      };

      const handleDeploy = async () => {
        const btnDeploy = document.getElementById("btn-deploy");
        btnDeploy.disabled = true;
        btnDeploy.innerText = "Deploying...";
        const fromAddress = (await web3.eth.getAccounts())[0];
        const contract = new web3.eth.Contract(JSON.parse(contractABI));
        const contractInstance = await contract
          .deploy({
            data: contractByteCode,
            arguments: ["Hello World!"]
          })
          .send({
            from: fromAddress
          });
        console.log("Completed:", contractInstance.options);
        contractAddress = contractInstance.options.address;
        render();
      };

      const handleLogout = async () => {
        await magic.user.logout();
        render();
      };
    </script>
  </head>
  <body onload="render()">
    <div id="app">
      <div class="container">Loading...</div>
    </div>
  </body>
</html>